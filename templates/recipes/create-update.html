{% extends "base.html" %}

{% block content %}

<style media="screen">
  .hidden {
    display: none
    }
</style>


{% include "recipes/partials/forms.html" %}

<h3>Ingredients</h3>

{% for ingredient in recipe.get_ingredients %}
  {% include "recipes/partials/ingredient-inline.html" %}
{% endfor %}

{% if new_ingredient_url %}
  <div id="ingredient-create"> </div>

<button hx-get="{{ new_ingredient_url }}" hx-trigger="click" hx-target="#ingredient-create" hx-swap="beforeend">Add ingredient</button>

{% endif %}


<script type="text/javascript">
  // management - total new forms
  document.addEventListener('click', (event) => {
    if (event.target.id == 'add-more') {
      add_new_form(event)
    }
  });

  function add_new_form(event) {
    // prevent the form from submiting (in case the button type is "submit")
    if (event){
      event.preventDefault();
    }
    const totalNewForms = document.getElementById('id_form-TOTAL_FORMS');
    // grab all the ingredient forms
    const currentIngredientForms = document.getElementsByClassName('ingredient-form');
    // count them
    const currentFormCount = currentIngredientForms.length;
    // list of the forms (html element) -> useful for inserting the empty form at the end
    const ingredientFormListEl = document.getElementById('ingredient-form-list');
    // getting the empty form (original one has to be always hidden!!)
    const copyEmptyFormEl = document.getElementById('empty-form').cloneNode(true);

    // change the class name of the copy form (from hidden to ingredient-form)
    copyEmptyFormEl.setAttribute('class', 'ingredient-form');
    // id according to the index
    copyEmptyFormEl.setAttribute('id', `form-${currentFormCount}`);
    // change the total of new forms in the management
    totalNewForms.setAttribute('value', currentFormCount + 1);

    // I dont get this but it works
    const regex = new RegExp('__prefix__', 'g');
    copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex, currentFormCount);

    // now we add new empty form element to our html form
    ingredientFormListEl.append(copyEmptyFormEl);
  }
</script>



{% endblock %}
